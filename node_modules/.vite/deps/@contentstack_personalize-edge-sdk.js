import {
  __commonJS
} from "./chunk-BUSYA2B4.js";

// node_modules/cross-fetch/dist/browser-ponyfill.js
var require_browser_ponyfill = __commonJS({
  "node_modules/cross-fetch/dist/browser-ponyfill.js"(exports, module) {
    var __global__ = typeof globalThis !== "undefined" && globalThis || typeof self !== "undefined" && self || typeof global !== "undefined" && global;
    var __globalThis__ = (function() {
      function F() {
        this.fetch = false;
        this.DOMException = __global__.DOMException;
      }
      F.prototype = __global__;
      return new F();
    })();
    (function(globalThis2) {
      var irrelevant = (function(exports2) {
        var g = typeof globalThis2 !== "undefined" && globalThis2 || typeof self !== "undefined" && self || // eslint-disable-next-line no-undef
        typeof global !== "undefined" && global || {};
        var support = {
          searchParams: "URLSearchParams" in g,
          iterable: "Symbol" in g && "iterator" in Symbol,
          blob: "FileReader" in g && "Blob" in g && (function() {
            try {
              new Blob();
              return true;
            } catch (e) {
              return false;
            }
          })(),
          formData: "FormData" in g,
          arrayBuffer: "ArrayBuffer" in g
        };
        function isDataView(obj) {
          return obj && DataView.prototype.isPrototypeOf(obj);
        }
        if (support.arrayBuffer) {
          var viewClasses = [
            "[object Int8Array]",
            "[object Uint8Array]",
            "[object Uint8ClampedArray]",
            "[object Int16Array]",
            "[object Uint16Array]",
            "[object Int32Array]",
            "[object Uint32Array]",
            "[object Float32Array]",
            "[object Float64Array]"
          ];
          var isArrayBufferView = ArrayBuffer.isView || function(obj) {
            return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1;
          };
        }
        function normalizeName(name) {
          if (typeof name !== "string") {
            name = String(name);
          }
          if (/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(name) || name === "") {
            throw new TypeError('Invalid character in header field name: "' + name + '"');
          }
          return name.toLowerCase();
        }
        function normalizeValue(value) {
          if (typeof value !== "string") {
            value = String(value);
          }
          return value;
        }
        function iteratorFor(items) {
          var iterator = {
            next: function() {
              var value = items.shift();
              return { done: value === void 0, value };
            }
          };
          if (support.iterable) {
            iterator[Symbol.iterator] = function() {
              return iterator;
            };
          }
          return iterator;
        }
        function Headers(headers) {
          this.map = {};
          if (headers instanceof Headers) {
            headers.forEach(function(value, name) {
              this.append(name, value);
            }, this);
          } else if (Array.isArray(headers)) {
            headers.forEach(function(header) {
              if (header.length != 2) {
                throw new TypeError("Headers constructor: expected name/value pair to be length 2, found" + header.length);
              }
              this.append(header[0], header[1]);
            }, this);
          } else if (headers) {
            Object.getOwnPropertyNames(headers).forEach(function(name) {
              this.append(name, headers[name]);
            }, this);
          }
        }
        Headers.prototype.append = function(name, value) {
          name = normalizeName(name);
          value = normalizeValue(value);
          var oldValue = this.map[name];
          this.map[name] = oldValue ? oldValue + ", " + value : value;
        };
        Headers.prototype["delete"] = function(name) {
          delete this.map[normalizeName(name)];
        };
        Headers.prototype.get = function(name) {
          name = normalizeName(name);
          return this.has(name) ? this.map[name] : null;
        };
        Headers.prototype.has = function(name) {
          return this.map.hasOwnProperty(normalizeName(name));
        };
        Headers.prototype.set = function(name, value) {
          this.map[normalizeName(name)] = normalizeValue(value);
        };
        Headers.prototype.forEach = function(callback, thisArg) {
          for (var name in this.map) {
            if (this.map.hasOwnProperty(name)) {
              callback.call(thisArg, this.map[name], name, this);
            }
          }
        };
        Headers.prototype.keys = function() {
          var items = [];
          this.forEach(function(value, name) {
            items.push(name);
          });
          return iteratorFor(items);
        };
        Headers.prototype.values = function() {
          var items = [];
          this.forEach(function(value) {
            items.push(value);
          });
          return iteratorFor(items);
        };
        Headers.prototype.entries = function() {
          var items = [];
          this.forEach(function(value, name) {
            items.push([name, value]);
          });
          return iteratorFor(items);
        };
        if (support.iterable) {
          Headers.prototype[Symbol.iterator] = Headers.prototype.entries;
        }
        function consumed(body) {
          if (body._noBody) return;
          if (body.bodyUsed) {
            return Promise.reject(new TypeError("Already read"));
          }
          body.bodyUsed = true;
        }
        function fileReaderReady(reader) {
          return new Promise(function(resolve, reject) {
            reader.onload = function() {
              resolve(reader.result);
            };
            reader.onerror = function() {
              reject(reader.error);
            };
          });
        }
        function readBlobAsArrayBuffer(blob) {
          var reader = new FileReader();
          var promise = fileReaderReady(reader);
          reader.readAsArrayBuffer(blob);
          return promise;
        }
        function readBlobAsText(blob) {
          var reader = new FileReader();
          var promise = fileReaderReady(reader);
          var match = /charset=([A-Za-z0-9_-]+)/.exec(blob.type);
          var encoding = match ? match[1] : "utf-8";
          reader.readAsText(blob, encoding);
          return promise;
        }
        function readArrayBufferAsText(buf) {
          var view = new Uint8Array(buf);
          var chars = new Array(view.length);
          for (var i = 0; i < view.length; i++) {
            chars[i] = String.fromCharCode(view[i]);
          }
          return chars.join("");
        }
        function bufferClone(buf) {
          if (buf.slice) {
            return buf.slice(0);
          } else {
            var view = new Uint8Array(buf.byteLength);
            view.set(new Uint8Array(buf));
            return view.buffer;
          }
        }
        function Body() {
          this.bodyUsed = false;
          this._initBody = function(body) {
            this.bodyUsed = this.bodyUsed;
            this._bodyInit = body;
            if (!body) {
              this._noBody = true;
              this._bodyText = "";
            } else if (typeof body === "string") {
              this._bodyText = body;
            } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {
              this._bodyBlob = body;
            } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {
              this._bodyFormData = body;
            } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {
              this._bodyText = body.toString();
            } else if (support.arrayBuffer && support.blob && isDataView(body)) {
              this._bodyArrayBuffer = bufferClone(body.buffer);
              this._bodyInit = new Blob([this._bodyArrayBuffer]);
            } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {
              this._bodyArrayBuffer = bufferClone(body);
            } else {
              this._bodyText = body = Object.prototype.toString.call(body);
            }
            if (!this.headers.get("content-type")) {
              if (typeof body === "string") {
                this.headers.set("content-type", "text/plain;charset=UTF-8");
              } else if (this._bodyBlob && this._bodyBlob.type) {
                this.headers.set("content-type", this._bodyBlob.type);
              } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {
                this.headers.set("content-type", "application/x-www-form-urlencoded;charset=UTF-8");
              }
            }
          };
          if (support.blob) {
            this.blob = function() {
              var rejected = consumed(this);
              if (rejected) {
                return rejected;
              }
              if (this._bodyBlob) {
                return Promise.resolve(this._bodyBlob);
              } else if (this._bodyArrayBuffer) {
                return Promise.resolve(new Blob([this._bodyArrayBuffer]));
              } else if (this._bodyFormData) {
                throw new Error("could not read FormData body as blob");
              } else {
                return Promise.resolve(new Blob([this._bodyText]));
              }
            };
          }
          this.arrayBuffer = function() {
            if (this._bodyArrayBuffer) {
              var isConsumed = consumed(this);
              if (isConsumed) {
                return isConsumed;
              } else if (ArrayBuffer.isView(this._bodyArrayBuffer)) {
                return Promise.resolve(
                  this._bodyArrayBuffer.buffer.slice(
                    this._bodyArrayBuffer.byteOffset,
                    this._bodyArrayBuffer.byteOffset + this._bodyArrayBuffer.byteLength
                  )
                );
              } else {
                return Promise.resolve(this._bodyArrayBuffer);
              }
            } else if (support.blob) {
              return this.blob().then(readBlobAsArrayBuffer);
            } else {
              throw new Error("could not read as ArrayBuffer");
            }
          };
          this.text = function() {
            var rejected = consumed(this);
            if (rejected) {
              return rejected;
            }
            if (this._bodyBlob) {
              return readBlobAsText(this._bodyBlob);
            } else if (this._bodyArrayBuffer) {
              return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));
            } else if (this._bodyFormData) {
              throw new Error("could not read FormData body as text");
            } else {
              return Promise.resolve(this._bodyText);
            }
          };
          if (support.formData) {
            this.formData = function() {
              return this.text().then(decode);
            };
          }
          this.json = function() {
            return this.text().then(JSON.parse);
          };
          return this;
        }
        var methods = ["CONNECT", "DELETE", "GET", "HEAD", "OPTIONS", "PATCH", "POST", "PUT", "TRACE"];
        function normalizeMethod(method) {
          var upcased = method.toUpperCase();
          return methods.indexOf(upcased) > -1 ? upcased : method;
        }
        function Request(input, options) {
          if (!(this instanceof Request)) {
            throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');
          }
          options = options || {};
          var body = options.body;
          if (input instanceof Request) {
            if (input.bodyUsed) {
              throw new TypeError("Already read");
            }
            this.url = input.url;
            this.credentials = input.credentials;
            if (!options.headers) {
              this.headers = new Headers(input.headers);
            }
            this.method = input.method;
            this.mode = input.mode;
            this.signal = input.signal;
            if (!body && input._bodyInit != null) {
              body = input._bodyInit;
              input.bodyUsed = true;
            }
          } else {
            this.url = String(input);
          }
          this.credentials = options.credentials || this.credentials || "same-origin";
          if (options.headers || !this.headers) {
            this.headers = new Headers(options.headers);
          }
          this.method = normalizeMethod(options.method || this.method || "GET");
          this.mode = options.mode || this.mode || null;
          this.signal = options.signal || this.signal || (function() {
            if ("AbortController" in g) {
              var ctrl = new AbortController();
              return ctrl.signal;
            }
          })();
          this.referrer = null;
          if ((this.method === "GET" || this.method === "HEAD") && body) {
            throw new TypeError("Body not allowed for GET or HEAD requests");
          }
          this._initBody(body);
          if (this.method === "GET" || this.method === "HEAD") {
            if (options.cache === "no-store" || options.cache === "no-cache") {
              var reParamSearch = /([?&])_=[^&]*/;
              if (reParamSearch.test(this.url)) {
                this.url = this.url.replace(reParamSearch, "$1_=" + (/* @__PURE__ */ new Date()).getTime());
              } else {
                var reQueryString = /\?/;
                this.url += (reQueryString.test(this.url) ? "&" : "?") + "_=" + (/* @__PURE__ */ new Date()).getTime();
              }
            }
          }
        }
        Request.prototype.clone = function() {
          return new Request(this, { body: this._bodyInit });
        };
        function decode(body) {
          var form = new FormData();
          body.trim().split("&").forEach(function(bytes) {
            if (bytes) {
              var split = bytes.split("=");
              var name = split.shift().replace(/\+/g, " ");
              var value = split.join("=").replace(/\+/g, " ");
              form.append(decodeURIComponent(name), decodeURIComponent(value));
            }
          });
          return form;
        }
        function parseHeaders(rawHeaders) {
          var headers = new Headers();
          var preProcessedHeaders = rawHeaders.replace(/\r?\n[\t ]+/g, " ");
          preProcessedHeaders.split("\r").map(function(header) {
            return header.indexOf("\n") === 0 ? header.substr(1, header.length) : header;
          }).forEach(function(line) {
            var parts = line.split(":");
            var key = parts.shift().trim();
            if (key) {
              var value = parts.join(":").trim();
              try {
                headers.append(key, value);
              } catch (error) {
                console.warn("Response " + error.message);
              }
            }
          });
          return headers;
        }
        Body.call(Request.prototype);
        function Response(bodyInit, options) {
          if (!(this instanceof Response)) {
            throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');
          }
          if (!options) {
            options = {};
          }
          this.type = "default";
          this.status = options.status === void 0 ? 200 : options.status;
          if (this.status < 200 || this.status > 599) {
            throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");
          }
          this.ok = this.status >= 200 && this.status < 300;
          this.statusText = options.statusText === void 0 ? "" : "" + options.statusText;
          this.headers = new Headers(options.headers);
          this.url = options.url || "";
          this._initBody(bodyInit);
        }
        Body.call(Response.prototype);
        Response.prototype.clone = function() {
          return new Response(this._bodyInit, {
            status: this.status,
            statusText: this.statusText,
            headers: new Headers(this.headers),
            url: this.url
          });
        };
        Response.error = function() {
          var response = new Response(null, { status: 200, statusText: "" });
          response.ok = false;
          response.status = 0;
          response.type = "error";
          return response;
        };
        var redirectStatuses = [301, 302, 303, 307, 308];
        Response.redirect = function(url, status) {
          if (redirectStatuses.indexOf(status) === -1) {
            throw new RangeError("Invalid status code");
          }
          return new Response(null, { status, headers: { location: url } });
        };
        exports2.DOMException = g.DOMException;
        try {
          new exports2.DOMException();
        } catch (err) {
          exports2.DOMException = function(message, name) {
            this.message = message;
            this.name = name;
            var error = Error(message);
            this.stack = error.stack;
          };
          exports2.DOMException.prototype = Object.create(Error.prototype);
          exports2.DOMException.prototype.constructor = exports2.DOMException;
        }
        function fetch(input, init) {
          return new Promise(function(resolve, reject) {
            var request = new Request(input, init);
            if (request.signal && request.signal.aborted) {
              return reject(new exports2.DOMException("Aborted", "AbortError"));
            }
            var xhr = new XMLHttpRequest();
            function abortXhr() {
              xhr.abort();
            }
            xhr.onload = function() {
              var options = {
                statusText: xhr.statusText,
                headers: parseHeaders(xhr.getAllResponseHeaders() || "")
              };
              if (request.url.indexOf("file://") === 0 && (xhr.status < 200 || xhr.status > 599)) {
                options.status = 200;
              } else {
                options.status = xhr.status;
              }
              options.url = "responseURL" in xhr ? xhr.responseURL : options.headers.get("X-Request-URL");
              var body = "response" in xhr ? xhr.response : xhr.responseText;
              setTimeout(function() {
                resolve(new Response(body, options));
              }, 0);
            };
            xhr.onerror = function() {
              setTimeout(function() {
                reject(new TypeError("Network request failed"));
              }, 0);
            };
            xhr.ontimeout = function() {
              setTimeout(function() {
                reject(new TypeError("Network request timed out"));
              }, 0);
            };
            xhr.onabort = function() {
              setTimeout(function() {
                reject(new exports2.DOMException("Aborted", "AbortError"));
              }, 0);
            };
            function fixUrl(url) {
              try {
                return url === "" && g.location.href ? g.location.href : url;
              } catch (e) {
                return url;
              }
            }
            xhr.open(request.method, fixUrl(request.url), true);
            if (request.credentials === "include") {
              xhr.withCredentials = true;
            } else if (request.credentials === "omit") {
              xhr.withCredentials = false;
            }
            if ("responseType" in xhr) {
              if (support.blob) {
                xhr.responseType = "blob";
              } else if (support.arrayBuffer) {
                xhr.responseType = "arraybuffer";
              }
            }
            if (init && typeof init.headers === "object" && !(init.headers instanceof Headers || g.Headers && init.headers instanceof g.Headers)) {
              var names = [];
              Object.getOwnPropertyNames(init.headers).forEach(function(name) {
                names.push(normalizeName(name));
                xhr.setRequestHeader(name, normalizeValue(init.headers[name]));
              });
              request.headers.forEach(function(value, name) {
                if (names.indexOf(name) === -1) {
                  xhr.setRequestHeader(name, value);
                }
              });
            } else {
              request.headers.forEach(function(value, name) {
                xhr.setRequestHeader(name, value);
              });
            }
            if (request.signal) {
              request.signal.addEventListener("abort", abortXhr);
              xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                  request.signal.removeEventListener("abort", abortXhr);
                }
              };
            }
            xhr.send(typeof request._bodyInit === "undefined" ? null : request._bodyInit);
          });
        }
        fetch.polyfill = true;
        if (!g.fetch) {
          g.fetch = fetch;
          g.Headers = Headers;
          g.Request = Request;
          g.Response = Response;
        }
        exports2.Headers = Headers;
        exports2.Request = Request;
        exports2.Response = Response;
        exports2.fetch = fetch;
        return exports2;
      })({});
    })(__globalThis__);
    __globalThis__.fetch.ponyfill = true;
    delete __globalThis__.fetch.polyfill;
    var ctx = __global__.fetch ? __global__ : __globalThis__;
    exports = ctx.fetch;
    exports.default = ctx.fetch;
    exports.fetch = ctx.fetch;
    exports.Headers = ctx.Headers;
    exports.Request = ctx.Request;
    exports.Response = ctx.Response;
    module.exports = exports;
  }
});

// node_modules/@contentstack/personalize-edge-sdk/dist/build-info.js
var require_build_info = __commonJS({
  "node_modules/@contentstack/personalize-edge-sdk/dist/build-info.js"(exports) {
    "use strict";
    exports.__esModule = true;
    exports["default"] = { version: "1.0.19", date: (/* @__PURE__ */ new Date()).toISOString() };
  }
});

// node_modules/@contentstack/personalize-edge-sdk/dist/edge-api.errors.js
var require_edge_api_errors = __commonJS({
  "node_modules/@contentstack/personalize-edge-sdk/dist/edge-api.errors.js"(exports) {
    "use strict";
    exports.__esModule = true;
    exports.ManifestError = void 0;
    var ManifestError;
    (function(ManifestError2) {
      ManifestError2["PROJECT_NOT_FOUND"] = "personalize.MANIFEST.PROJECT_NOT_FOUND";
    })(ManifestError = exports.ManifestError || (exports.ManifestError = {}));
  }
});

// node_modules/@contentstack/personalize-edge-sdk/dist/event-ingestion.type.js
var require_event_ingestion_type = __commonJS({
  "node_modules/@contentstack/personalize-edge-sdk/dist/event-ingestion.type.js"(exports) {
    "use strict";
    exports.__esModule = true;
    exports.IngestEventType = void 0;
    var IngestEventType;
    (function(IngestEventType2) {
      IngestEventType2["IMPRESSION"] = "IMPRESSION";
      IngestEventType2["CUSTOM_EVENT"] = "EVENT";
    })(IngestEventType = exports.IngestEventType || (exports.IngestEventType = {}));
  }
});

// node_modules/@contentstack/personalize-edge-sdk/dist/sdk.js
var require_sdk = __commonJS({
  "node_modules/@contentstack/personalize-edge-sdk/dist/sdk.js"(exports) {
    "use strict";
    var __assign = exports && exports.__assign || function() {
      __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };
    var __awaiter = exports && exports.__awaiter || function(thisArg, _arguments, P, generator) {
      function adopt(value) {
        return value instanceof P ? value : new P(function(resolve) {
          resolve(value);
        });
      }
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = exports && exports.__generator || function(thisArg, body) {
      var _ = { label: 0, sent: function() {
        if (t[0] & 1) throw t[1];
        return t[1];
      }, trys: [], ops: [] }, f, y, t, g;
      return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([n, v]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          if (y = 0, t) op = [op[0] & 2, t.value];
          switch (op[0]) {
            case 0:
            case 1:
              t = op;
              break;
            case 4:
              _.label++;
              return { value: op[1], done: false };
            case 5:
              _.label++;
              y = op[1];
              op = [0];
              continue;
            case 7:
              op = _.ops.pop();
              _.trys.pop();
              continue;
            default:
              if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                _ = 0;
                continue;
              }
              if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {
                _.label = op[1];
                break;
              }
              if (op[0] === 6 && _.label < t[1]) {
                _.label = t[1];
                t = op;
                break;
              }
              if (t && _.label < t[2]) {
                _.label = t[2];
                _.ops.push(op);
                break;
              }
              if (t[2]) _.ops.pop();
              _.trys.pop();
              continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [6, e];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (op[0] & 5) throw op[1];
        return { value: op[0] ? op[1] : void 0, done: true };
      }
    };
    var __importDefault = exports && exports.__importDefault || function(mod) {
      return mod && mod.__esModule ? mod : { "default": mod };
    };
    exports.__esModule = true;
    exports.Sdk = void 0;
    var cross_fetch_1 = __importDefault(require_browser_ponyfill());
    var build_info_1 = __importDefault(require_build_info());
    var event_ingestion_type_1 = require_event_ingestion_type();
    var PROJECT_UID_HEADER_KEY = "X-Project-Uid";
    var USER_UID_HEADER_KEY = "X-CS-Personalize-User-Uid";
    var USER_UID_COOKIE_KEY = "cs-personalize-user-uid";
    var USER_UID_COOKIE_MAX_AGE = 365;
    var MANIFEST_COOKIE_KEY = "cs-personalize-manifest";
    var SET_COOKIE_HEADER_KEY = "Set-Cookie";
    var CS_PERSONALIZE_PREFIX = "cs_personalize";
    var X_USER_AGENT = "X-User-Agent";
    var X_USER_AGENT_VALUE = "personalize-edge-sdk-js/".concat(build_info_1["default"].version);
    var Sdk = (
      /** @class */
      (function() {
        function Sdk2(projectUid, manifestData, edgeApiURL, userId, isBrowserEnvironment, variantQueryParam) {
          this._isBrowserEnvironment = false;
          this._projectUid = projectUid;
          this._manifestData = manifestData;
          this._edgeApiURL = edgeApiURL;
          this._userId = userId;
          this._isBrowserEnvironment = isBrowserEnvironment;
          this.VARIANT_QUERY_PARAM = variantQueryParam;
        }
        Sdk2.prototype.getExperiences = function() {
          return this._manifestData.experiences;
        };
        Sdk2.prototype.triggerImpression = function(experienceShortUid) {
          return __awaiter(this, void 0, void 0, function() {
            return __generator(this, function(_a) {
              return [2, this.triggerImpressions({
                experienceShortUids: [experienceShortUid]
              })];
            });
          });
        };
        Sdk2.prototype.triggerImpressions = function(triggerImpressionOptions) {
          return __awaiter(this, void 0, void 0, function() {
            var experienceAndVariants, impressions;
            var _a;
            var _this = this;
            return __generator(this, function(_b) {
              switch (_b.label) {
                case 0:
                  if (!triggerImpressionOptions.aliases && !triggerImpressionOptions.experienceShortUids) {
                    throw new Error("Cannot trigger impression without options");
                  }
                  if (triggerImpressionOptions.aliases) {
                    experienceAndVariants = triggerImpressionOptions.aliases.map(this.getExperienceAndVariantFromAlias);
                  } else {
                    experienceAndVariants = triggerImpressionOptions.experienceShortUids.map(function(experienceShortUid) {
                      return {
                        experienceShortUid,
                        variantShortUid: _this.getActiveVariant(experienceShortUid)
                      };
                    }, this);
                  }
                  impressions = experienceAndVariants.filter(function(experienceAndVariant) {
                    return !!experienceAndVariant.variantShortUid;
                  }).map(function(_a2) {
                    var experienceShortUid = _a2.experienceShortUid, variantShortUid = _a2.variantShortUid;
                    return {
                      experienceShortUid,
                      variantShortUid,
                      type: event_ingestion_type_1.IngestEventType.IMPRESSION
                    };
                  });
                  return [4, (0, cross_fetch_1["default"])("".concat(this._edgeApiURL, "/events"), {
                    method: "POST",
                    headers: (_a = {}, _a[PROJECT_UID_HEADER_KEY] = this._projectUid, _a[USER_UID_HEADER_KEY] = this._userId, _a[X_USER_AGENT] = X_USER_AGENT_VALUE, _a),
                    body: JSON.stringify(impressions)
                  })];
                case 1:
                  _b.sent();
                  return [
                    2
                    /*return*/
                  ];
              }
            });
          });
        };
        Sdk2.prototype.triggerEvent = function(eventKey) {
          return __awaiter(this, void 0, void 0, function() {
            var customEvent;
            var _a;
            return __generator(this, function(_b) {
              switch (_b.label) {
                case 0:
                  customEvent = {
                    eventKey,
                    type: event_ingestion_type_1.IngestEventType.CUSTOM_EVENT
                  };
                  return [4, (0, cross_fetch_1["default"])("".concat(this._edgeApiURL, "/events"), {
                    method: "POST",
                    headers: (_a = {}, _a[PROJECT_UID_HEADER_KEY] = this._projectUid, _a[USER_UID_HEADER_KEY] = this._userId, _a[X_USER_AGENT] = X_USER_AGENT_VALUE, _a),
                    body: JSON.stringify([customEvent])
                  })];
                case 1:
                  _b.sent();
                  return [
                    2
                    /*return*/
                  ];
              }
            });
          });
        };
        Sdk2.prototype.set = function(clientAttributes) {
          return __awaiter(this, void 0, void 0, function() {
            return __generator(this, function(_a) {
              switch (_a.label) {
                case 0:
                  return [4, this.setUserAttributesOnEdge(clientAttributes)];
                case 1:
                  _a.sent();
                  return [
                    2
                    /*return*/
                  ];
              }
            });
          });
        };
        Sdk2.prototype.setUserId = function(userId, options) {
          return __awaiter(this, void 0, void 0, function() {
            var source_user_uid, mergeUserAttrsBody;
            var _a;
            return __generator(this, function(_b) {
              switch (_b.label) {
                case 0:
                  source_user_uid = this._userId;
                  this._userId = userId;
                  if (this._isBrowserEnvironment) {
                    document.cookie = this.generateCookie(USER_UID_COOKIE_KEY, userId, {
                      days: USER_UID_COOKIE_MAX_AGE,
                      path: "/"
                    });
                  }
                  if (!(source_user_uid && (options === null || options === void 0 ? void 0 : options.preserveUserAttributes))) return [3, 2];
                  mergeUserAttrsBody = {
                    sourceUserUid: source_user_uid,
                    targetUserUid: userId
                  };
                  return [4, (0, cross_fetch_1["default"])("".concat(this._edgeApiURL, "/user-attributes/actions/merge"), {
                    method: "POST",
                    headers: (_a = {}, _a[PROJECT_UID_HEADER_KEY] = this._projectUid, _a[X_USER_AGENT] = X_USER_AGENT_VALUE, _a),
                    body: JSON.stringify(mergeUserAttrsBody)
                  })];
                case 1:
                  _b.sent();
                  _b.label = 2;
                case 2:
                  return [
                    2
                    /*return*/
                  ];
              }
            });
          });
        };
        Sdk2.prototype.getUserId = function() {
          return this._userId;
        };
        Sdk2.prototype.getActiveVariant = function(experienceShortUid) {
          var _a;
          return (_a = this._manifestData.experiences.find(function(manifestExperience) {
            return manifestExperience.shortUid === experienceShortUid;
          })) === null || _a === void 0 ? void 0 : _a.activeVariantShortUid;
        };
        Sdk2.prototype.addStateToResponse = function(response) {
          var userIdCookie = this.generateCookie(USER_UID_COOKIE_KEY, this._userId, {
            days: USER_UID_COOKIE_MAX_AGE,
            path: "/"
          });
          var manifestCookie = this.generateCookie(MANIFEST_COOKIE_KEY, JSON.stringify(this._manifestData), { path: "/" });
          response.headers.append(SET_COOKIE_HEADER_KEY, userIdCookie);
          response.headers.append(SET_COOKIE_HEADER_KEY, manifestCookie);
        };
        Sdk2.prototype.getVariants = function() {
          return this._manifestData.experiences.reduce(function(activeVariants, manifestExperience) {
            var _a;
            return __assign(__assign({}, activeVariants), (_a = {}, _a[manifestExperience.shortUid] = manifestExperience.activeVariantShortUid, _a));
          }, {});
        };
        Sdk2.prototype.getVariantAliases = function() {
          return this.getCompactAliases().map(function(alias) {
            return "".concat(CS_PERSONALIZE_PREFIX, "_").concat(alias);
          });
        };
        Sdk2.prototype.getVariantParam = function() {
          return this.getCompactAliases().join(",");
        };
        Sdk2.prototype.variantParamToVariantAliases = function(variantParam) {
          return variantParam.split(",").map(function(alias) {
            return "".concat(CS_PERSONALIZE_PREFIX, "_").concat(alias);
          });
        };
        Sdk2.prototype.getCompactAliases = function() {
          return this._manifestData.experiences.filter(function(experience) {
            return experience.activeVariantShortUid !== null;
          }).map(function(experience) {
            return "".concat(experience.shortUid, "_").concat(experience.activeVariantShortUid);
          });
        };
        Sdk2.prototype.getExperienceAndVariantFromAlias = function(alias) {
          var _a = alias.split("_"), experienceShortUid = _a[2], _variantShortUid = _a[3];
          var variantShortUid = _variantShortUid === "null" ? null : _variantShortUid;
          return { experienceShortUid, variantShortUid };
        };
        Sdk2.prototype.generateCookie = function(name, value, options) {
          var secondsInADay = 86400;
          var cookieString = "".concat(name, "=").concat(value);
          if (options === null || options === void 0 ? void 0 : options.days) {
            cookieString = "".concat(cookieString, "; Max-Age=").concat(options.days * secondsInADay);
          }
          if (options === null || options === void 0 ? void 0 : options.path) {
            cookieString = "".concat(cookieString, "; Path=").concat(options.path);
          }
          return cookieString;
        };
        Sdk2.prototype.setUserAttributesOnEdge = function(userAttributes) {
          return __awaiter(this, void 0, void 0, function() {
            var _a;
            return __generator(this, function(_b) {
              switch (_b.label) {
                case 0:
                  return [4, (0, cross_fetch_1["default"])("".concat(this._edgeApiURL, "/user-attributes"), {
                    method: "PATCH",
                    headers: (_a = {}, _a[PROJECT_UID_HEADER_KEY] = this._projectUid, _a[USER_UID_HEADER_KEY] = this._userId, _a[X_USER_AGENT] = X_USER_AGENT_VALUE, _a),
                    body: JSON.stringify(userAttributes)
                  })];
                case 1:
                  return [2, _b.sent()];
              }
            });
          });
        };
        return Sdk2;
      })()
    );
    exports.Sdk = Sdk;
  }
});

// node_modules/@contentstack/personalize-edge-sdk/dist/personalize.js
var require_personalize = __commonJS({
  "node_modules/@contentstack/personalize-edge-sdk/dist/personalize.js"(exports) {
    "use strict";
    var __assign = exports && exports.__assign || function() {
      __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };
    var __awaiter = exports && exports.__awaiter || function(thisArg, _arguments, P, generator) {
      function adopt(value) {
        return value instanceof P ? value : new P(function(resolve) {
          resolve(value);
        });
      }
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = exports && exports.__generator || function(thisArg, body) {
      var _ = { label: 0, sent: function() {
        if (t[0] & 1) throw t[1];
        return t[1];
      }, trys: [], ops: [] }, f, y, t, g;
      return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([n, v]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          if (y = 0, t) op = [op[0] & 2, t.value];
          switch (op[0]) {
            case 0:
            case 1:
              t = op;
              break;
            case 4:
              _.label++;
              return { value: op[1], done: false };
            case 5:
              _.label++;
              y = op[1];
              op = [0];
              continue;
            case 7:
              op = _.ops.pop();
              _.trys.pop();
              continue;
            default:
              if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                _ = 0;
                continue;
              }
              if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {
                _.label = op[1];
                break;
              }
              if (op[0] === 6 && _.label < t[1]) {
                _.label = t[1];
                t = op;
                break;
              }
              if (t && _.label < t[2]) {
                _.label = t[2];
                _.ops.push(op);
                break;
              }
              if (t[2]) _.ops.pop();
              _.trys.pop();
              continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [6, e];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (op[0] & 5) throw op[1];
        return { value: op[0] ? op[1] : void 0, done: true };
      }
    };
    var __importDefault = exports && exports.__importDefault || function(mod) {
      return mod && mod.__esModule ? mod : { "default": mod };
    };
    exports.__esModule = true;
    exports.Personalize = void 0;
    var cross_fetch_1 = __importDefault(require_browser_ponyfill());
    var build_info_1 = __importDefault(require_build_info());
    var edge_api_errors_1 = require_edge_api_errors();
    var sdk_1 = require_sdk();
    var PROJECT_UID_HEADER_KEY = "X-Project-Uid";
    var USER_UID_HEADER_KEY = "X-CS-Personalize-User-Uid";
    var USER_UID_COOKIE_KEY = "cs-personalize-user-uid";
    var LIVE_ATTRIBUTES_HEADER_KEY = "X-Live-Attributes";
    var LYTICS_AUDIENCES_COOKIE_KEY = "cs-lytics-audiences";
    var LYTICS_AUDIENCES_LIVE_ATTRIBUTES_KEY = "__lytics_audiences";
    var USER_UID_COOKIE_MAX_AGE = 365;
    var MANIFEST_COOKIE_KEY = "cs-personalize-manifest";
    var REFERER_HEADER_KEY = "Referer";
    var PAGE_URL_HEADER_KEY = "X-Page-Url";
    var X_FORWARDED_FOR_HEADER_KEY = "X-Forwarded-For";
    var USER_AGENT_HEADER_KEY = "User-Agent";
    var COOKIE_HEADER_KEY = "Cookie";
    var CS_PERSONALIZE_PREFIX = "cs_personalize";
    var X_USER_AGENT = "X-User-Agent";
    var X_USER_AGENT_VALUE = "personalize-edge-sdk-js/".concat(build_info_1["default"].version);
    var migrationDocLink = "https://www.contentstack.com/docs/developers/sdks/personalize-edge-sdk/javascript/javascript-personalize-edge-v109-migration-guide";
    var Personalize;
    (function(Personalize2) {
      var _edgeApiURL = "https://personalize-edge.contentstack.com";
      var _isBrowserEnvironment = false;
      var _projectUid;
      var _userId;
      var _manifestData;
      var _initializationDeferredPromise;
      var _initializationStatus;
      var _sdk;
      var _liveAttributes = {};
      Personalize2.VARIANT_QUERY_PARAM = "personalize_variants";
      function init(projectUid, options) {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function() {
          var userIdFromCookie, cookieString, lyticsAudiencesFromCookie, cookieString, manifestFromCookie, parsedManifestFromCookie, _c, manifest, userId, error_1, sdk;
          return __generator(this, function(_d) {
            switch (_d.label) {
              case 0:
                setInitializationStatus("initializing");
                buildInitializationDeferredPromise();
                _isBrowserEnvironment = isBrowserEnvironment();
                _projectUid = projectUid;
                if (options === null || options === void 0 ? void 0 : options.request) {
                  cookieString = options.request.headers.get(COOKIE_HEADER_KEY);
                  if (cookieString) {
                    userIdFromCookie = getCookieValueByName(USER_UID_COOKIE_KEY, cookieString);
                  }
                } else {
                  userIdFromCookie = getValueFromCookies(USER_UID_COOKIE_KEY);
                }
                if (options === null || options === void 0 ? void 0 : options.request) {
                  cookieString = options.request.headers.get(COOKIE_HEADER_KEY);
                  if (cookieString) {
                    lyticsAudiencesFromCookie = getCookieValueByName(LYTICS_AUDIENCES_COOKIE_KEY, cookieString);
                  }
                } else {
                  lyticsAudiencesFromCookie = getValueFromCookies(LYTICS_AUDIENCES_COOKIE_KEY);
                }
                if (lyticsAudiencesFromCookie) {
                  _liveAttributes[LYTICS_AUDIENCES_LIVE_ATTRIBUTES_KEY] = lyticsAudiencesFromCookie;
                }
                if (options === null || options === void 0 ? void 0 : options.liveAttributes) {
                  _liveAttributes = __assign(__assign({}, _liveAttributes), options.liveAttributes);
                }
                manifestFromCookie = getValueFromCookies(MANIFEST_COOKIE_KEY);
                _userId = (_a = options === null || options === void 0 ? void 0 : options.userId) !== null && _a !== void 0 ? _a : userIdFromCookie;
                if (options === null || options === void 0 ? void 0 : options.customVariantQueryParam) {
                  Personalize2.VARIANT_QUERY_PARAM = options.customVariantQueryParam;
                }
                if (!manifestFromCookie) return [3, 1];
                parsedManifestFromCookie = JSON.parse(manifestFromCookie);
                _manifestData = parsedManifestFromCookie;
                if (!parsedManifestFromCookie.experiences) {
                  _manifestData.experiences = Object.keys(_manifestData.activeVariants).map(function(shortUid) {
                    return {
                      shortUid,
                      activeVariantShortUid: _manifestData.activeVariants[shortUid]
                    };
                  });
                }
                return [3, 5];
              case 1:
                _d.trys.push([1, 3, , 4]);
                return [4, fetchManifest(_liveAttributes, options === null || options === void 0 ? void 0 : options.request)];
              case 2:
                _c = _d.sent(), manifest = _c.manifest, userId = _c.userId;
                _manifestData = manifest;
                _userId = userId;
                return [3, 4];
              case 3:
                error_1 = _d.sent();
                setInitializationStatus("error");
                throw error_1;
              case 4:
                if (_isBrowserEnvironment) {
                  document.cookie = generateCookie(USER_UID_COOKIE_KEY, _userId, {
                    days: USER_UID_COOKIE_MAX_AGE,
                    path: "/"
                  });
                }
                _d.label = 5;
              case 5:
                resolveAndResetInitializationPromise();
                setInitializationStatus("success");
                sdk = new sdk_1.Sdk(projectUid, Object.assign({}, _manifestData), _edgeApiURL, _userId, _isBrowserEnvironment, (_b = options === null || options === void 0 ? void 0 : options.customVariantQueryParam) !== null && _b !== void 0 ? _b : Personalize2.VARIANT_QUERY_PARAM);
                _sdk = sdk;
                return [2, sdk];
            }
          });
        });
      }
      Personalize2.init = init;
      function setEdgeApiUrl(edgeApiUrl) {
        _edgeApiURL = edgeApiUrl;
      }
      Personalize2.setEdgeApiUrl = setEdgeApiUrl;
      function getExperiences() {
        logDeprecationWarning("getExperiences");
        var initStatus = getInitializationStatus();
        if (initStatus != "success") {
          throw new Error("Cannot get experiences before initialization");
        }
        return _sdk.getExperiences();
      }
      Personalize2.getExperiences = getExperiences;
      function triggerImpression(experienceShortUid) {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
              case 0:
                logDeprecationWarning("triggerImpression");
                if (!(getInitializationStatus() === "initializing")) return [3, 2];
                return [4, waitForInit()];
              case 1:
                _a.sent();
                _a.label = 2;
              case 2:
                if (getInitializationStatus() !== "success") {
                  throw new Error("Cannot trigger impression before initialization");
                }
                return [2, _sdk.triggerImpression(experienceShortUid)];
            }
          });
        });
      }
      Personalize2.triggerImpression = triggerImpression;
      function triggerImpressions(triggerImpressionOptions) {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
              case 0:
                logDeprecationWarning("triggerImpressions");
                if (!(getInitializationStatus() === "initializing")) return [3, 2];
                return [4, waitForInit()];
              case 1:
                _a.sent();
                _a.label = 2;
              case 2:
                if (getInitializationStatus() !== "success") {
                  throw new Error("Cannot trigger impressions before initialization");
                }
                if (!triggerImpressionOptions.aliases && !triggerImpressionOptions.experienceShortUids) {
                  throw new Error("Cannot trigger impressions without options");
                }
                return [4, _sdk.triggerImpressions(triggerImpressionOptions)];
              case 3:
                _a.sent();
                return [
                  2
                  /*return*/
                ];
            }
          });
        });
      }
      Personalize2.triggerImpressions = triggerImpressions;
      function triggerEvent(eventKey) {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
              case 0:
                logDeprecationWarning("triggerEvent");
                if (!(getInitializationStatus() === "initializing")) return [3, 2];
                return [4, waitForInit()];
              case 1:
                _a.sent();
                _a.label = 2;
              case 2:
                if (getInitializationStatus() !== "success") {
                  throw new Error("Cannot trigger event before initialization");
                }
                return [4, _sdk.triggerEvent(eventKey)];
              case 3:
                _a.sent();
                return [
                  2
                  /*return*/
                ];
            }
          });
        });
      }
      Personalize2.triggerEvent = triggerEvent;
      function set(clientAttributes) {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
              case 0:
                logDeprecationWarning("set");
                if (!(getInitializationStatus() === "initializing")) return [3, 2];
                return [4, waitForInit()];
              case 1:
                _a.sent();
                _a.label = 2;
              case 2:
                if (getInitializationStatus() !== "success") {
                  throw new Error("Cannot set user attributes before initialization");
                }
                return [4, _sdk.set(clientAttributes)];
              case 3:
                _a.sent();
                return [
                  2
                  /*return*/
                ];
            }
          });
        });
      }
      Personalize2.set = set;
      function setUserId(userId, options) {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            logDeprecationWarning("setUserId");
            if (getInitializationStatus() === "success") {
              return [2, _sdk.setUserId(userId, options)];
            }
            _userId = userId;
            return [
              2
              /*return*/
            ];
          });
        });
      }
      Personalize2.setUserId = setUserId;
      function getUserId() {
        logDeprecationWarning("getUserId");
        return _userId;
      }
      Personalize2.getUserId = getUserId;
      function getActiveVariant(experienceShortUid) {
        logDeprecationWarning("getActiveVariant");
        var initStatus = getInitializationStatus();
        if (initStatus !== "success") {
          throw new Error("Cannot get active variant before initialization");
        }
        return _sdk.getActiveVariant(experienceShortUid);
      }
      Personalize2.getActiveVariant = getActiveVariant;
      function getInitializationStatus() {
        return _initializationStatus;
      }
      Personalize2.getInitializationStatus = getInitializationStatus;
      function addStateToResponse(response) {
        return __awaiter(this, void 0, void 0, function() {
          var initStatus;
          return __generator(this, function(_a) {
            logDeprecationWarning("addStateToResponse");
            initStatus = Personalize2.getInitializationStatus();
            if (initStatus != "success") {
              throw new Error("Cannot add state to response before initialization");
            }
            _sdk.addStateToResponse(response);
            return [
              2
              /*return*/
            ];
          });
        });
      }
      Personalize2.addStateToResponse = addStateToResponse;
      function getVariants() {
        logDeprecationWarning("getVariants");
        var initStatus = getInitializationStatus();
        if (initStatus != "success") {
          throw new Error("Cannot get variants before initialization");
        }
        return _sdk.getVariants();
      }
      Personalize2.getVariants = getVariants;
      function getVariantAliases() {
        logDeprecationWarning("getVariantAliases");
        var initStatus = getInitializationStatus();
        if (initStatus != "success") {
          throw new Error("Cannot get variant aliases before initialization");
        }
        return _sdk.getVariantAliases();
      }
      Personalize2.getVariantAliases = getVariantAliases;
      function getVariantParam() {
        logDeprecationWarning("getVariantParam");
        var initStatus = getInitializationStatus();
        if (initStatus != "success") {
          throw new Error("Cannot get variant alias param before initialization");
        }
        return _sdk.getVariantParam();
      }
      Personalize2.getVariantParam = getVariantParam;
      function variantParamToVariantAliases(variantParam) {
        return variantParam.split(",").map(function(alias) {
          return "".concat(CS_PERSONALIZE_PREFIX, "_").concat(alias);
        });
      }
      Personalize2.variantParamToVariantAliases = variantParamToVariantAliases;
      function reset() {
        console.warn("[personalize-edge-sdk] Personalize.reset is deprecated as a part of the move to using the SDK instance. It will be removed \nin a future release. For more information, see ".concat(migrationDocLink, "."));
        _isBrowserEnvironment = isBrowserEnvironment();
        _userId = void 0;
        _manifestData = void 0;
        _sdk = void 0;
        resetInitializationDeferredPromise();
        resetInitializationStatus();
        if (_isBrowserEnvironment) {
          removeCookie(USER_UID_COOKIE_KEY);
          removeCookie(MANIFEST_COOKIE_KEY);
        }
      }
      Personalize2.reset = reset;
      function resetData() {
        _projectUid = void 0;
        _userId = void 0;
        _isBrowserEnvironment = false;
        _manifestData = void 0;
        _sdk = void 0;
        _liveAttributes = {};
        resetInitializationDeferredPromise();
        resetInitializationStatus();
      }
      Personalize2.resetData = resetData;
      function generateCookie(name, value, options) {
        var secondsInADay = 86400;
        var cookieString = "".concat(name, "=").concat(value);
        if (options === null || options === void 0 ? void 0 : options.days) {
          cookieString = "".concat(cookieString, "; Max-Age=").concat(options.days * secondsInADay);
        }
        if (options === null || options === void 0 ? void 0 : options.path) {
          cookieString = "".concat(cookieString, "; Path=").concat(options.path);
        }
        return cookieString;
      }
      function isBrowserEnvironment() {
        return typeof window !== "undefined" && typeof document !== "undefined";
      }
      function getValueFromCookies(cookieKey) {
        if (!_isBrowserEnvironment) {
          return null;
        }
        return getCookieValueByName(cookieKey, document.cookie);
      }
      function getCookieValueByName(name, cookieString) {
        var allCookies = cookieString.split(";");
        var userUidCookie = allCookies.find(function(cookie) {
          return cookie.trim().startsWith("".concat(name, "="));
        });
        return userUidCookie ? userUidCookie.trim().split("=")[1] : null;
      }
      function removeCookie(name) {
        document.cookie = "".concat(encodeURIComponent(name), "=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/");
      }
      function fetchManifest(liveAttributes, request) {
        return __awaiter(this, void 0, void 0, function() {
          var manifestRequestHeaders, pageUrl, referer, ipAddress, userAgent, hasLiveAttributes, manifestResponse, errorBody, userId, manifest;
          var _a;
          return __generator(this, function(_b) {
            switch (_b.label) {
              case 0:
                manifestRequestHeaders = (_a = {}, _a[PROJECT_UID_HEADER_KEY] = _projectUid, _a);
                pageUrl = getPageUrl(request);
                if (pageUrl) {
                  manifestRequestHeaders[PAGE_URL_HEADER_KEY] = pageUrl;
                }
                referer = getReferer(request);
                if (referer) {
                  manifestRequestHeaders[REFERER_HEADER_KEY] = referer;
                }
                ipAddress = getIPAddress(request);
                if (ipAddress) {
                  manifestRequestHeaders[X_FORWARDED_FOR_HEADER_KEY] = ipAddress;
                }
                userAgent = getUserAgent(request);
                if (userAgent) {
                  manifestRequestHeaders[USER_AGENT_HEADER_KEY] = userAgent;
                }
                if (_userId) {
                  manifestRequestHeaders[USER_UID_HEADER_KEY] = _userId;
                }
                hasLiveAttributes = !isObjectEmpty(liveAttributes);
                if (hasLiveAttributes) {
                  manifestRequestHeaders[LIVE_ATTRIBUTES_HEADER_KEY] = JSON.stringify(liveAttributes);
                }
                manifestRequestHeaders[X_USER_AGENT] = X_USER_AGENT_VALUE;
                return [4, (0, cross_fetch_1["default"])("".concat(_edgeApiURL, "/manifest"), {
                  headers: manifestRequestHeaders
                })];
              case 1:
                manifestResponse = _b.sent();
                if (!!manifestResponse.ok) return [3, 4];
                if (!(manifestResponse.status === 404)) return [3, 3];
                return [4, manifestResponse.json()];
              case 2:
                errorBody = _b.sent();
                if (errorBody.error === edge_api_errors_1.ManifestError.PROJECT_NOT_FOUND) {
                  throw new Error("Project not found: ".concat(_projectUid));
                }
                _b.label = 3;
              case 3:
                throw new Error("Could not fetch manifest: ".concat(manifestResponse.status));
              case 4:
                userId = manifestResponse.headers.get(USER_UID_HEADER_KEY);
                return [4, manifestResponse.json()];
              case 5:
                manifest = _b.sent();
                return [2, { manifest, userId }];
            }
          });
        });
      }
      function getPageUrl(req) {
        if (req === null || req === void 0 ? void 0 : req.url) {
          return req === null || req === void 0 ? void 0 : req.url;
        }
        return _isBrowserEnvironment ? document.URL : void 0;
      }
      function getReferer(req) {
        if (req === null || req === void 0 ? void 0 : req.headers.has(REFERER_HEADER_KEY)) {
          return req.headers.get(REFERER_HEADER_KEY);
        }
        return _isBrowserEnvironment ? document.referrer : void 0;
      }
      function getIPAddress(req) {
        if (req === null || req === void 0 ? void 0 : req.headers.has(X_FORWARDED_FOR_HEADER_KEY)) {
          return req.headers.get(X_FORWARDED_FOR_HEADER_KEY);
        }
      }
      function getUserAgent(req) {
        if (req === null || req === void 0 ? void 0 : req.headers.has(USER_AGENT_HEADER_KEY)) {
          return req.headers.get(USER_AGENT_HEADER_KEY);
        }
      }
      function buildInitializationDeferredPromise() {
        var resolvePromise;
        var rejectPromise;
        var promise = new Promise(function(resolve, reject) {
          resolvePromise = resolve;
          rejectPromise = reject;
        });
        _initializationDeferredPromise = {
          promise,
          resolve: resolvePromise,
          reject: rejectPromise
        };
      }
      function resolveAndResetInitializationPromise() {
        if (_initializationDeferredPromise) {
          _initializationDeferredPromise.resolve();
        }
        resetInitializationDeferredPromise();
      }
      function resetInitializationDeferredPromise() {
        _initializationDeferredPromise = void 0;
      }
      function setInitializationStatus(initStatus) {
        _initializationStatus = initStatus;
      }
      function resetInitializationStatus() {
        _initializationStatus = void 0;
      }
      function waitForInit() {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
              case 0:
                if (!_initializationDeferredPromise) return [3, 2];
                return [4, _initializationDeferredPromise.promise];
              case 1:
                _a.sent();
                _a.label = 2;
              case 2:
                return [
                  2
                  /*return*/
                ];
            }
          });
        });
      }
    })(Personalize = exports.Personalize || (exports.Personalize = {}));
    function logDeprecationWarning(functionName) {
      var sdkContextPrefix = "[personalize-edge-sdk]";
      var deprecationNotice = "Calling the Personalize.".concat(functionName, " as a global function in the Personalize Edge SDK has been deprecated.");
      var updatedUsageSuggestion = "Instead create an SDK instance (e.g., const sdk = await Personalize.init()) and call the ".concat(functionName, " method there (e.g., sdk.").concat(functionName, "()).");
      var migrationNotice = "For more information, see ".concat(migrationDocLink, ".");
      console.warn("".concat(sdkContextPrefix, " ").concat(deprecationNotice, " ").concat(updatedUsageSuggestion, " ").concat(migrationNotice));
    }
    function isObjectEmpty(obj) {
      return Object.keys(obj).length === 0;
    }
  }
});

// node_modules/@contentstack/personalize-edge-sdk/dist/index.js
var require_dist = __commonJS({
  "node_modules/@contentstack/personalize-edge-sdk/dist/index.js"(exports, module) {
    var personalize_1 = require_personalize();
    Object.assign(module.exports, personalize_1.Personalize);
    module.exports = personalize_1.Personalize;
  }
});
export default require_dist();
//# sourceMappingURL=@contentstack_personalize-edge-sdk.js.map
