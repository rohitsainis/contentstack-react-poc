var personalize=function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}var r="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,a=t(function(e,t){var a="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof r&&r,s=function(){function e(){this.fetch=!1,this.DOMException=a.DOMException}return e.prototype=a,new e}();(function(e){(function(t){function a(e){return e&&DataView.prototype.isPrototypeOf(e)}function s(e){if("string"!=typeof e&&(e+=""),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError("Invalid character in header field name: \""+e+"\"");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e+=""),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return g.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){return e._noBody?void 0:e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function l(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=l(t);return t.readAsArrayBuffer(e),r}function c(e){var t=new FileReader,r=l(t),a=/charset=([A-Za-z0-9_-]+)/.exec(e.type),s=a?a[1]:"utf-8";return t.readAsText(e,s),r}function u(e){for(var t=String.fromCharCode,r=new Uint8Array(e),a=Array(r.length),s=0;s<r.length;s++)a[s]=t(r[s]);return a.join("")}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:g.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:g.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():g.arrayBuffer&&g.blob&&a(e)?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||x(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");else return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=d(this);return e?e:ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)}if(g.blob)return this.blob().then(p);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return c(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");else return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function h(e){var t=e.toUpperCase();return-1<R.indexOf(t)?t:e}function b(e,t){if(!(this instanceof b))throw new TypeError("Please use the \"new\" operator, this DOM object constructor cannot be called as a function.");t=t||{};var r=t.body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=e+"";if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new i(t.headers)),this.method=h(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in U){var e=new AbortController;return e.signal}}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),("GET"===this.method||"HEAD"===this.method)&&("no-store"===t.cache||"no-cache"===t.cache)){var a=/([?&])_=[^&]*/;if(a.test(this.url))this.url=this.url.replace(a,"$1_="+new Date().getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}function _(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),a=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(s))}}),t}function m(e){var t=new i,r=e.replace(/\r?\n[\t ]+/g," ");return r.split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),a=r.shift().trim();if(a){var s=r.join(":").trim();try{t.append(a,s)}catch(e){console.warn("Response "+e.message)}}}),t}function E(e,t){if(!(this instanceof E))throw new TypeError("Please use the \"new\" operator, this DOM object constructor cannot be called as a function.");if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,200>this.status||599<this.status)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=200<=this.status&&300>this.status,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}function A(e,r){return new Promise(function(a,n){function d(){p.abort()}var l=new b(e,r);if(l.signal&&l.signal.aborted)return n(new t.DOMException("Aborted","AbortError"));var p=new XMLHttpRequest;if(p.onload=function(){var e={statusText:p.statusText,headers:m(p.getAllResponseHeaders()||"")};e.status=0===l.url.indexOf("file://")&&(200>p.status||599<p.status)?200:p.status,e.url="responseURL"in p?p.responseURL:e.headers.get("X-Request-URL");var t="response"in p?p.response:p.responseText;setTimeout(function(){a(new E(t,e))},0)},p.onerror=function(){setTimeout(function(){n(new TypeError("Network request failed"))},0)},p.ontimeout=function(){setTimeout(function(){n(new TypeError("Network request timed out"))},0)},p.onabort=function(){setTimeout(function(){n(new t.DOMException("Aborted","AbortError"))},0)},p.open(l.method,function(t){try{return""===t&&U.location.href?U.location.href:t}catch(r){return t}}(l.url),!0),"include"===l.credentials?p.withCredentials=!0:"omit"===l.credentials&&(p.withCredentials=!1),"responseType"in p&&(g.blob?p.responseType="blob":g.arrayBuffer&&(p.responseType="arraybuffer")),r&&"object"==typeof r.headers&&!(r.headers instanceof i||U.Headers&&r.headers instanceof U.Headers)){var c=[];Object.getOwnPropertyNames(r.headers).forEach(function(e){c.push(s(e)),p.setRequestHeader(e,o(r.headers[e]))}),l.headers.forEach(function(e,t){-1===c.indexOf(t)&&p.setRequestHeader(t,e)})}else l.headers.forEach(function(e,t){p.setRequestHeader(t,e)});l.signal&&(l.signal.addEventListener("abort",d),p.onreadystatechange=function(){4===p.readyState&&l.signal.removeEventListener("abort",d)}),p.send("undefined"==typeof l._bodyInit?null:l._bodyInit)})}var U="undefined"!=typeof e&&e||"undefined"!=typeof self&&self||"undefined"!=typeof r&&r||{},g={searchParams:"URLSearchParams"in U,iterable:"Symbol"in U&&"iterator"in Symbol,blob:"FileReader"in U&&"Blob"in U&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in U,arrayBuffer:"ArrayBuffer"in U};if(g.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],x=ArrayBuffer.isView||function(e){return e&&-1<v.indexOf(Object.prototype.toString.call(e))};i.prototype.append=function(e,t){e=s(e),t=o(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},i.prototype["delete"]=function(e){delete this.map[s(e)]},i.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},i.prototype.set=function(e,t){this.map[s(e)]=o(t)},i.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},g.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var R=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},y.call(b.prototype),y.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var T=[301,302,303,307,308];E.redirect=function(e,t){if(-1===T.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},t.DOMException=U.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}return A.polyfill=!0,U.fetch||(U.fetch=A,U.Headers=i,U.Request=b,U.Response=E),t.Headers=i,t.Request=b,t.Response=E,t.fetch=A,t})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var o=a.fetch?a:s;t=o.fetch,t.default=o.fetch,t.fetch=o.fetch,t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response,e.exports=t});a.fetch,a.Headers,a.Request,a.Response;var s=t(function(e,t){t.__esModule=!0,t["default"]={version:"1.0.19",date:new Date().toISOString()}});e(s);var o=t(function(e,t){t.__esModule=!0,t.ManifestError=void 0,function(e){e.PROJECT_NOT_FOUND="personalize.MANIFEST.PROJECT_NOT_FOUND"}(t.ManifestError||(t.ManifestError={}))});e(o),o.ManifestError;var n=t(function(e,t){t.__esModule=!0,t.IngestEventType=void 0,function(e){e.IMPRESSION="IMPRESSION",e.CUSTOM_EVENT="EVENT"}(t.IngestEventType||(t.IngestEventType={}))});e(n),n.IngestEventType;var i=t(function(e,t){var o=r&&r.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)},i=r&&r.__awaiter||function(e,t,r,a){function s(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,o){function n(e){try{d(a.next(e))}catch(t){o(t)}}function i(e){try{d(a["throw"](e))}catch(t){o(t)}}function d(e){e.done?r(e.value):s(e.value).then(n,i)}d((a=a.apply(e,t||[])).next())})},d=r&&r.__generator||function(e,r){function a(e){return function(t){return s([e,t])}}function s(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(i=2&t[0]?n["return"]:t[0]?n["throw"]||((i=n["return"])&&i.call(n),0):n.next)&&!(i=i.call(n,t[1])).done)return i;switch((n=0,i)&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if((i=l.trys,!(i=0<i.length&&i[i.length-1]))&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(e,l)}catch(r){t=[6,r],n=0}finally{o=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,n,i,d,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return d={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d},l=r&&r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.Sdk=void 0;var p=l(a),c=l(s),u="X-Project-Uid",f="X-CS-Personalize-User-Uid",y="cs-personalize-user-uid",h=365,g="Set-Cookie",b="cs_personalize",_="X-User-Agent",m="personalize-edge-sdk-js/".concat(c["default"].version),E=function(){function e(e,t,r,a,s,o){this._isBrowserEnvironment=!1,this._projectUid=e,this._manifestData=t,this._edgeApiURL=r,this._userId=a,this._isBrowserEnvironment=s,this.VARIANT_QUERY_PARAM=o}return e.prototype.getExperiences=function(){return this._manifestData.experiences},e.prototype.triggerImpression=function(e){return i(this,void 0,void 0,function(){return d(this,function(){return[2,this.triggerImpressions({experienceShortUids:[e]})]})})},e.prototype.triggerImpressions=function(e){return i(this,void 0,void 0,function(){var t,r,a;return d(this,function(s){switch(s.label){case 0:if(!e.aliases&&!e.experienceShortUids)throw new Error("Cannot trigger impression without options");return t=e.aliases?e.aliases.map(this.getExperienceAndVariantFromAlias):e.experienceShortUids.map(function(e){return{experienceShortUid:e,variantShortUid:this.getActiveVariant(e)}},this),r=t.filter(function(e){return!!e.variantShortUid}).map(function(e){var t=e.experienceShortUid,r=e.variantShortUid;return{experienceShortUid:t,variantShortUid:r,type:n.IngestEventType.IMPRESSION}}),[4,(0,p["default"])("".concat(this._edgeApiURL,"/events"),{method:"POST",headers:(a={},a[u]=this._projectUid,a[f]=this._userId,a[_]=m,a),body:JSON.stringify(r)})];case 1:return s.sent(),[2]}})})},e.prototype.triggerEvent=function(e){return i(this,void 0,void 0,function(){var t,r;return d(this,function(a){switch(a.label){case 0:return t={eventKey:e,type:n.IngestEventType.CUSTOM_EVENT},[4,(0,p["default"])("".concat(this._edgeApiURL,"/events"),{method:"POST",headers:(r={},r[u]=this._projectUid,r[f]=this._userId,r[_]=m,r),body:JSON.stringify([t])})];case 1:return a.sent(),[2]}})})},e.prototype.set=function(e){return i(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return[4,this.setUserAttributesOnEdge(e)];case 1:return t.sent(),[2]}})})},e.prototype.setUserId=function(e,t){return i(this,void 0,void 0,function(){var r,a,s;return d(this,function(o){switch(o.label){case 0:return(r=this._userId,this._userId=e,this._isBrowserEnvironment&&(document.cookie=this.generateCookie(y,e,{days:h,path:"/"})),!(r&&(null===t||void 0===t?void 0:t.preserveUserAttributes)))?[3,2]:(a={sourceUserUid:r,targetUserUid:e},[4,(0,p["default"])("".concat(this._edgeApiURL,"/user-attributes/actions/merge"),{method:"POST",headers:(s={},s[u]=this._projectUid,s[_]=m,s),body:JSON.stringify(a)})]);case 1:o.sent(),o.label=2;case 2:return[2]}})})},e.prototype.getUserId=function(){return this._userId},e.prototype.getActiveVariant=function(e){var t;return null===(t=this._manifestData.experiences.find(function(t){return t.shortUid===e}))||void 0===t?void 0:t.activeVariantShortUid},e.prototype.addStateToResponse=function(e){var t=this.generateCookie(y,this._userId,{days:h,path:"/"}),r=this.generateCookie("cs-personalize-manifest",JSON.stringify(this._manifestData),{path:"/"});e.headers.append(g,t),e.headers.append(g,r)},e.prototype.getVariants=function(){return this._manifestData.experiences.reduce(function(e,t){var r;return o(o({},e),(r={},r[t.shortUid]=t.activeVariantShortUid,r))},{})},e.prototype.getVariantAliases=function(){return this.getCompactAliases().map(function(e){return"".concat(b,"_").concat(e)})},e.prototype.getVariantParam=function(){return this.getCompactAliases().join(",")},e.prototype.variantParamToVariantAliases=function(e){return e.split(",").map(function(e){return"".concat(b,"_").concat(e)})},e.prototype.getCompactAliases=function(){return this._manifestData.experiences.filter(function(e){return null!==e.activeVariantShortUid}).map(function(e){return"".concat(e.shortUid,"_").concat(e.activeVariantShortUid)})},e.prototype.getExperienceAndVariantFromAlias=function(e){var t=e.split("_"),r=t[2],a=t[3],s="null"===a?null:a;return{experienceShortUid:r,variantShortUid:s}},e.prototype.generateCookie=function(e,t,r){var a="".concat(e,"=").concat(t);return(null===r||void 0===r?void 0:r.days)&&(a="".concat(a,"; Max-Age=").concat(86400*r.days)),(null===r||void 0===r?void 0:r.path)&&(a="".concat(a,"; Path=").concat(r.path)),a},e.prototype.setUserAttributesOnEdge=function(e){return i(this,void 0,void 0,function(){var t;return d(this,function(r){switch(r.label){case 0:return[4,(0,p["default"])("".concat(this._edgeApiURL,"/user-attributes"),{method:"PATCH",headers:(t={},t[u]=this._projectUid,t[f]=this._userId,t[_]=m,t),body:JSON.stringify(e)})];case 1:return[2,r.sent()]}})})},e}();t.Sdk=E});e(i),i.Sdk;var d=t(function(e,t){function n(e){var t="Calling the Personalize.".concat(e," as a global function in the Personalize Edge SDK has been deprecated."),r="Instead create an SDK instance (e.g., const sdk = await Personalize.init()) and call the ".concat(e," method there (e.g., sdk.").concat(e,"())."),a="For more information, see ".concat("https://www.contentstack.com/docs/developers/sdks/personalize-edge-sdk/javascript/javascript-personalize-edge-v109-migration-guide",".");console.warn("".concat("[personalize-edge-sdk]"," ").concat(t," ").concat(r," ").concat(a))}function d(e){return 0===Object.keys(e).length}var l=r&&r.__assign||function(){return l=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l.apply(this,arguments)},p=r&&r.__awaiter||function(e,t,r,a){function s(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,o){function n(e){try{d(a.next(e))}catch(t){o(t)}}function i(e){try{d(a["throw"](e))}catch(t){o(t)}}function d(e){e.done?r(e.value):s(e.value).then(n,i)}d((a=a.apply(e,t||[])).next())})},c=r&&r.__generator||function(e,r){function a(e){return function(t){return s([e,t])}}function s(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(i=2&t[0]?n["return"]:t[0]?n["throw"]||((i=n["return"])&&i.call(n),0):n.next)&&!(i=i.call(n,t[1])).done)return i;switch((n=0,i)&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if((i=l.trys,!(i=0<i.length&&i[i.length-1]))&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(e,l)}catch(r){t=[6,r],n=0}finally{o=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,n,i,d,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return d={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d},u=r&&r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.Personalize=void 0;var f=u(a),y=u(s),h="X-CS-Personalize-User-Uid",g="cs-personalize-user-uid",b="cs-lytics-audiences",_="cs-personalize-manifest",m="Referer",E="X-Forwarded-For",A="User-Agent",U="Cookie",v="personalize-edge-sdk-js/".concat(y["default"].version);(function(e){function t(){n("getExperiences");var e=s();if("success"!=e)throw new Error("Cannot get experiences before initialization");return Y.getExperiences()}function r(){return n("getUserId"),q}function a(e){n("getActiveVariant");var t=s();if("success"!==t)throw new Error("Cannot get active variant before initialization");return Y.getActiveVariant(e)}function s(){return X}function u(){n("getVariants");var e=s();if("success"!=e)throw new Error("Cannot get variants before initialization");return Y.getVariants()}function y(){n("getVariantAliases");var e=s();if("success"!=e)throw new Error("Cannot get variant aliases before initialization");return Y.getVariantAliases()}function x(){n("getVariantParam");var e=s();if("success"!=e)throw new Error("Cannot get variant alias param before initialization");return Y.getVariantParam()}function R(){console.warn("[personalize-edge-sdk] Personalize.reset is deprecated as a part of the move to using the SDK instance. It will be removed \nin a future release. For more information, see ".concat("https://www.contentstack.com/docs/developers/sdks/personalize-edge-sdk/javascript/javascript-personalize-edge-v109-migration-guide",".")),J=I(),q=void 0,L=void 0,Y=void 0,k(),H(),J&&(D(g),D(_))}function T(e,t,r){var a="".concat(e,"=").concat(t);return(null===r||void 0===r?void 0:r.days)&&(a="".concat(a,"; Max-Age=").concat(86400*r.days)),(null===r||void 0===r?void 0:r.path)&&(a="".concat(a,"; Path=").concat(r.path)),a}function I(){return"undefined"!=typeof window&&"undefined"!=typeof document}function P(e){return J?S(e,document.cookie):null}function S(e,t){var r=t.split(";"),a=r.find(function(t){return t.trim().startsWith("".concat(e,"="))});return a?a.trim().split("=")[1]:null}function D(e){document.cookie="".concat(encodeURIComponent(e),"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function O(e,t){return p(this,void 0,void 0,function(){var r,a,s,n,i,l,p,u,y,g,b;return c(this,function(c){switch(c.label){case 0:return r=(b={},b["X-Project-Uid"]=F,b),a=C(t),a&&(r["X-Page-Url"]=a),s=z(t),s&&(r[m]=s),n=w(t),n&&(r[E]=n),i=B(t),i&&(r[A]=i),q&&(r[h]=q),l=!d(e),l&&(r["X-Live-Attributes"]=JSON.stringify(e)),r["X-User-Agent"]=v,[4,(0,f["default"])("".concat(G,"/manifest"),{headers:r})];case 1:return p=c.sent(),p.ok?[3,4]:404===p.status?[4,p.json()]:[3,3];case 2:if(u=c.sent(),u.error===o.ManifestError.PROJECT_NOT_FOUND)throw new Error("Project not found: ".concat(F));c.label=3;case 3:throw new Error("Could not fetch manifest: ".concat(p.status));case 4:return y=p.headers.get(h),[4,p.json()];case 5:return g=c.sent(),[2,{manifest:g,userId:y}]}})})}function C(e){return(null===e||void 0===e?void 0:e.url)?null===e||void 0===e?void 0:e.url:J?document.URL:void 0}function z(e){return(null===e||void 0===e?void 0:e.headers.has(m))?e.headers.get(m):J?document.referrer:void 0}function w(e){if(null===e||void 0===e?void 0:e.headers.has(E))return e.headers.get(E)}function B(e){if(null===e||void 0===e?void 0:e.headers.has(A))return e.headers.get(A)}function V(){var e,t,r=new Promise(function(r,a){e=r,t=a});K={promise:r,resolve:e,reject:t}}function M(){K&&K.resolve(),k()}function k(){K=void 0}function j(e){X=e}function H(){X=void 0}function N(){return p(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return K?[4,K.promise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})}var F,q,L,K,X,Y,G="https://personalize-edge.contentstack.com",J=!1,Q={};e.VARIANT_QUERY_PARAM="personalize_variants",e.init=function(t,r){var a,s;return p(this,void 0,void 0,function(){var o,n,d,n,p,u,f,y,h,m,E;return c(this,function(c){switch(c.label){case 0:return(j("initializing"),V(),J=I(),F=t,(null===r||void 0===r?void 0:r.request)?(n=r.request.headers.get(U),n&&(o=S(g,n))):o=P(g),(null===r||void 0===r?void 0:r.request)?(n=r.request.headers.get(U),n&&(d=S(b,n))):d=P(b),d&&(Q["__lytics_audiences"]=d),(null===r||void 0===r?void 0:r.liveAttributes)&&(Q=l(l({},Q),r.liveAttributes)),p=P(_),q=null!==(a=null===r||void 0===r?void 0:r.userId)&&void 0!==a?a:o,(null===r||void 0===r?void 0:r.customVariantQueryParam)&&(e.VARIANT_QUERY_PARAM=r.customVariantQueryParam),!p)?[3,1]:(u=JSON.parse(p),L=u,u.experiences||(L.experiences=Object.keys(L.activeVariants).map(function(e){return{shortUid:e,activeVariantShortUid:L.activeVariants[e]}})),[3,5]);case 1:return c.trys.push([1,3,,4]),[4,O(Q,null===r||void 0===r?void 0:r.request)];case 2:return f=c.sent(),y=f.manifest,h=f.userId,L=y,q=h,[3,4];case 3:throw m=c.sent(),j("error"),m;case 4:J&&(document.cookie=T(g,q,{days:365,path:"/"})),c.label=5;case 5:return M(),j("success"),E=new i.Sdk(t,Object.assign({},L),G,q,J,null!==(s=null===r||void 0===r?void 0:r.customVariantQueryParam)&&void 0!==s?s:e.VARIANT_QUERY_PARAM),Y=E,[2,E]}})})},e.setEdgeApiUrl=function(e){G=e},e.getExperiences=t,e.triggerImpression=function(e){return p(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return n("triggerImpression"),"initializing"===s()?[4,N()]:[3,2];case 1:t.sent(),t.label=2;case 2:if("success"!==s())throw new Error("Cannot trigger impression before initialization");return[2,Y.triggerImpression(e)]}})})},e.triggerImpressions=function(e){return p(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return n("triggerImpressions"),"initializing"===s()?[4,N()]:[3,2];case 1:t.sent(),t.label=2;case 2:if("success"!==s())throw new Error("Cannot trigger impressions before initialization");if(!e.aliases&&!e.experienceShortUids)throw new Error("Cannot trigger impressions without options");return[4,Y.triggerImpressions(e)];case 3:return t.sent(),[2]}})})},e.triggerEvent=function(e){return p(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return n("triggerEvent"),"initializing"===s()?[4,N()]:[3,2];case 1:t.sent(),t.label=2;case 2:if("success"!==s())throw new Error("Cannot trigger event before initialization");return[4,Y.triggerEvent(e)];case 3:return t.sent(),[2]}})})},e.set=function(e){return p(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return n("set"),"initializing"===s()?[4,N()]:[3,2];case 1:t.sent(),t.label=2;case 2:if("success"!==s())throw new Error("Cannot set user attributes before initialization");return[4,Y.set(e)];case 3:return t.sent(),[2]}})})},e.setUserId=function(e,t){return p(this,void 0,void 0,function(){return c(this,function(){return(n("setUserId"),"success"===s())?[2,Y.setUserId(e,t)]:(q=e,[2])})})},e.getUserId=r,e.getActiveVariant=a,e.getInitializationStatus=s,e.addStateToResponse=function(t){return p(this,void 0,void 0,function(){var r;return c(this,function(){if(n("addStateToResponse"),r=e.getInitializationStatus(),"success"!=r)throw new Error("Cannot add state to response before initialization");return Y.addStateToResponse(t),[2]})})},e.getVariants=u,e.getVariantAliases=y,e.getVariantParam=x,e.variantParamToVariantAliases=function(e){return e.split(",").map(function(e){return"".concat("cs_personalize","_").concat(e)})},e.reset=R,e.resetData=function(){F=void 0,q=void 0,J=!1,L=void 0,Y=void 0,Q={},k(),H()}})(t.Personalize||(t.Personalize={}))});e(d),d.Personalize;var l=t(function(e){Object.assign(e.exports,d.Personalize),e.exports=d.Personalize});return l}();
//# sourceMappingURL=personalize-edge-sdk.min.js.map
